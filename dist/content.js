(()=>{const e="oldReddit",t="newRedditSubreddit",r="newRedditHome";chrome.runtime.onMessage.addListener(((e,t,r)=>{const a=JSON.parse(e);return"filter"===a.key&&(u(a.data),s().then(r(""))),!0}));const s=async()=>{let s,i=document.getElementById("main-content");if(null===i)i=document.getElementById("siteTable"),s=e;else{const e=i.getElementsByTagName("shreddit-feed");e.length>0?(i=e[0],s=r):(i=i.children[2],s=t)}const d=JSON.parse(window.localStorage.getItem("subredditFilterOptions"));a(i,d)&&n(i,d,s)},a=(e,t)=>null!==t&&null!==e,n=(r,s,a)=>{for(let l of r.children)a===t&&"FACEPLATE-BATCH"===l.tagName||a===e&&"sitetable linklisting"===l.getAttribute("class")?n(l,s,a):i(l,a)&&d(l,s,a)&&c(l,a)},i=(s,a)=>{switch(a){case e:return 0!==s.getAttribute("data-subreddit");case t:case r:return"ARTICLE"===s.tagName;default:return!1}},d=(t,r,s)=>{let a,n;s===e?(a=l(t,s),n=parseFloat(o(t,s))):(a=l(t,s),n=o(t,s));const i=r[a];if(void 0===i)return!1;const d=i.filterCategory,c=new Date(i.filterDateTime+"Z"),u=new Date(n);return"before"===d&&u<=c||"after"===d&&u>=c},l=(t,r)=>r===e?t.getAttribute("data-subreddit"):t.getElementsByTagName("shreddit-post")[0].getAttribute("subreddit-prefixed-name").substring(2),o=(t,r)=>r===e?t.getAttribute("data-timestamp"):t.getElementsByTagName("shreddit-post")[0].getAttribute("created-timestamp"),c=(s,a)=>{switch(a){case e:case t:case r:s.style.opacity=0;break;default:return}},u=e=>{window.localStorage.setItem("subredditFilterOptions",JSON.stringify(e))};try{chrome.runtime.sendMessage(JSON.stringify({key:"requestFilters"})).then()}catch(e){console.log(e)}setInterval((()=>{try{s().then()}catch(e){console.log(e)}}),4)})();