(()=>{const e="siteTable",t="main-content",a="oldRedditMain",r="newRedditMain",s="newRedditSubreddit",n="newRedditComments";chrome.runtime.onMessage.addListener(((e,t,a)=>{const r=JSON.parse(e);if("filter"===r.key){p(r.data);try{d()}catch(e){console.log(e)}a("")}return!0}));const d=()=>{const e=i(),t=c(e),a=JSON.parse(window.localStorage.getItem("subredditFilterOptions"))||null;l(t,a)&&u(t,a,e)},i=()=>{if(null===document.getElementById(t))return a;switch(document.getElementsByTagName("shreddit-app")[0].getAttribute("pagetype")){case"home":case"popular":case"all":return r;case"community":return s;case"post_detail":return n}},c=a=>{switch(a){case"oldReddit":return document.getElementById(e);case"newRedditMain":return document.getElementById(t).getElementsByTagName("shreddit-feed")[0];case"newRedditSubreddit":return document.getElementById(t).children[2];case"newRedditComments":return document.getElementById("comment-tree");default:return null}},l=(e,t)=>null!==t&&null!==e,u=(e,t,r)=>{for(let n of e.children)o(n,r)&&!f(n,r)&&m(n,t,r)?h(n,r):r===s&&"FACEPLATE-BATCH"===n.tagName||r===a&&"sitetable linklisting"===n.getAttribute("class")?u(n,t,r):o(n,r)&&!m(n,t,r)&&y(n,r)},o=(e,t)=>{switch(t){case a:return 0!==e.getAttribute("data-subreddit");case s:case r:return"ARTICLE"===e.tagName;case n:return"SHREDDIT-COMMENT"===e.tagName;default:return!1}},m=(e,t,d)=>{let i,c;switch(d){case a:i=g(e,d),c=parseFloat(b(e,d));break;case r:case s:case n:i=g(e,d),c=b(e,d);break;default:i=null,c=null}const l=t[i];if(!(i in t))return!1;const u=l.filterCategory,o=new Date(l.filterDateTime+"Z"),m=new Date(c);return"before"===u&&m<=o||"after"===u&&m>=o},g=(e,t)=>{switch(t){case a:return e.getAttribute("data-subreddit");case r:case s:return e.getElementsByTagName("shreddit-post")[0].getAttribute("subreddit-prefixed-name").substring(2);case n:return document.getElementsByTagName("shreddit-post")[0].getAttribute("subreddit-prefixed-name").substring(2);default:return""}},b=(e,t)=>{switch(t){case a:return e.getAttribute("data-timestamp");case r:case s:return e.getElementsByTagName("shreddit-post")[0].getAttribute("created-timestamp");case n:return e.getElementsByTagName("faceplate-timeago")[0].getAttribute("ts");default:return 0}},h=(e,t)=>{switch(t){case a:case s:case r:case n:e.style.opacity=0;break;default:return}},y=(e,t)=>{switch(t){case a:case s:case r:case n:e.style.opacity=1;break;default:return}},f=(e,t)=>{switch(t){case a:case s:case r:case n:return 0===e.style.opacity;default:return!1}},p=e=>{window.localStorage.setItem("subredditFilterOptions",JSON.stringify(e))},w=t=>{switch(i()){case"oldRedditMain":if(t.parentNode.id===e&&"DIV"===t.tagName)try{d()}catch(e){console.log(e)}break;case"newRedditMain":if("SHREDDIT-FEED"===t.parentNode.tagName&&"FACEPLATE-BATCH"===t.tagName)try{d()}catch(e){console.log(e)}break;case"newRedditSubreddit":if("DIV"===t.parentNode.tagName&&"FACEPLATE-BATCH"===t.tagName)try{d()}catch(e){console.log(e)}break;case"newRedditComments":if(t.parentNode.id===n)try{d()}catch(e){console.log(e)}}};try{chrome.runtime.sendMessage(JSON.stringify({key:"requestFilters"})).then(),(()=>{let e;switch(i()){case"oldRedditMain":e=document;break;case"newRedditMain":case"newRedditSubreddit":case"newRedditComments":e=document.getElementsByTagName("shreddit-app")[0];break;default:e=null}new MutationObserver(((e,t)=>{for(const t of e)switch(t.type){case"attributes":"pagetype"===t.attributeName&&chrome.runtime.sendMessage(JSON.stringify({key:"requestFilters"})).then();break;case"childList":case"subtree":for(let e=0;e<t.addedNodes.length;e++)try{w(t.addedNodes[e])}catch(e){console.log(e)}}})).observe(e,{attributes:!0,childList:!0,subtree:!0})})()}catch(e){console.log(e)}})();