(()=>{const e="siteTable",t="main-content",a="oldReddit",s="newRedditSubreddit",r="newRedditMain";chrome.runtime.onMessage.addListener(((e,t,a)=>{const s=JSON.parse(e);if("filter"===s.key){f(s.data);try{d()}catch(e){console.log(e)}a("")}return!0}));try{chrome.runtime.sendMessage(JSON.stringify({key:"requestFilters"})).then((()=>p()))}catch(e){console.log(e)}const d=()=>{const a=i();let s;switch(a){case"oldReddit":s=document.getElementById(e);break;case"newRedditMain":s=document.getElementById(t).getElementsByTagName("shreddit-feed")[0];break;case"newRedditSubreddit":s=document.getElementById(t).children[2];break;default:s=null}const r=JSON.parse(window.localStorage.getItem("subredditFilterOptions"))||null;n(s,r)&&c(s,r,a)},i=()=>{if(null===document.getElementById(t))return a;switch(document.getElementsByTagName("shreddit-app")[0].getAttribute("pagetype")){case"home":case"popular":case"all":return r;case"community":return s}},n=(e,t)=>null!==t&&null!==e,c=(e,t,r)=>{for(let d of e.children)l(d,r)&&!y(d,r)&&o(d,t,r)?m(d,r):l(d,r)&&!o(d,t,r)?b(d,r):(r===s&&"FACEPLATE-BATCH"===d.tagName||r===a&&"sitetable linklisting"===d.getAttribute("class"))&&c(d,t,r)},l=(e,t)=>{switch(t){case a:return 0!==e.getAttribute("data-subreddit");case s:case r:return"ARTICLE"===e.tagName;default:return!1}},o=(e,t,d)=>{let i,n;switch(d){case a:i=u(e,d),n=parseFloat(g(e,d));break;case r:case s:i=u(e,d),n=g(e,d);break;default:i=null,n=null}const c=t[i];if(!(i in t))return!1;const l=c.filterCategory,o=new Date(c.filterDateTime+"Z"),m=new Date(n);return"before"===l&&m<=o||"after"===l&&m>=o},u=(e,t)=>t===a?e.getAttribute("data-subreddit"):e.getElementsByTagName("shreddit-post")[0].getAttribute("subreddit-prefixed-name").substring(2),g=(e,t)=>t===a?e.getAttribute("data-timestamp"):e.getElementsByTagName("shreddit-post")[0].getAttribute("created-timestamp"),m=(e,t)=>{switch(t){case a:case s:case r:e.style.opacity=0;break;default:return}},b=(e,t)=>{switch(t){case a:case s:case r:e.style.opacity=1;break;default:return}},y=(e,t)=>{switch(t){case a:case s:case r:return 0===e.style.opacity;default:return!1}},f=e=>{window.localStorage.setItem("subredditFilterOptions",JSON.stringify(e))},h=t=>{switch(i()){case"oldReddit":if(t.parentNode.id===e&&"DIV"===t.tagName)try{d()}catch(e){console.log(e)}break;case"newRedditMain":if("SHREDDIT-FEED"===t.parentNode.tagName&&"FACEPLATE-BATCH"===t.tagName)try{d()}catch(e){console.log(e)}break;case"newRedditSubreddit":if("DIV"===t.parentNode.tagName&&"FACEPLATE-BATCH"===t.tagName)try{d()}catch(e){console.log(e)}}},p=()=>{let e;switch(i()){case"oldReddit":case"newRedditMain":case"newRedditSubreddit":e=document;break;default:e=null}new MutationObserver(((e,t)=>{for(const t of e)switch(t.type){case"attributes":if("pagetype"===t.attributeName)try{d()}catch(e){console.log(e)}break;case"subtree":for(let e=0;e<t.addedNodes.length;e++)h(t.addedNodes[e])}})).observe(e,{attributes:!0,childList:!0,subtree:!0})}})();