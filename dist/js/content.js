(()=>{const e="oldReddit",t="newRedditSubreddit",r="newRedditHome";let s=!0;chrome.runtime.onMessage.addListener(((e,t,r)=>{const s=JSON.parse(e);if("filter"===s.key){m(s.data);try{a()}catch(e){console.log(e)}r("")}return!0})),document.addEventListener("scroll",(()=>{if(s){s=!1;try{a()}catch(e){console.log(e)}setTimeout((()=>{s=!0}),1e3)}}));const a=()=>{let s,a=document.getElementById("main-content");if(null===a)a=document.getElementById("siteTable"),s=e;else{const e=a.getElementsByTagName("shreddit-feed");e.length>0?(a=e[0],s=r):(a=a.children[2],s=t)}const l=JSON.parse(window.localStorage.getItem("subredditFilterOptions"))||null;n(a,l)&&i(a,l,s)},n=(e,t)=>null!==t&&null!==e,i=(r,s,a)=>{for(let n of r.children)l(n,a)&&!g(n,a)&&d(n,s,a)?u(n,a):(a===t&&"FACEPLATE-BATCH"===n.tagName||a===e&&"sitetable linklisting"===n.getAttribute("class"))&&i(n,s,a)},l=(s,a)=>{switch(a){case e:return 0!==s.getAttribute("data-subreddit");case t:case r:return"ARTICLE"===s.tagName;default:return!1}},d=(t,r,s)=>{let a,n;s===e?(a=o(t,s),n=parseFloat(c(t,s))):(a=o(t,s),n=c(t,s));const i=r[a];if(void 0===i)return!1;const l=i.filterCategory,d=new Date(i.filterDateTime+"Z"),u=new Date(n);return"before"===l&&u<=d||"after"===l&&u>=d},o=(t,r)=>r===e?t.getAttribute("data-subreddit"):t.getElementsByTagName("shreddit-post")[0].getAttribute("subreddit-prefixed-name").substring(2),c=(t,r)=>r===e?t.getAttribute("data-timestamp"):t.getElementsByTagName("shreddit-post")[0].getAttribute("created-timestamp"),u=(s,a)=>{switch(a){case e:case t:case r:s.style.opacity=0;break;default:return}},g=(s,a)=>{switch(a){case e:case t:case r:return 0===s.style.opacity;default:return!1}},m=e=>{window.localStorage.setItem("subredditFilterOptions",JSON.stringify(e))};try{chrome.runtime.sendMessage(JSON.stringify({key:"requestFilters"})).then()}catch(e){console.log(e)}setInterval((()=>{try{a()}catch(e){console.log(e)}}),1e3)})();