(()=>{const e="oldReddit",t="newRedditSubreddit",r="newRedditHome";let a=!0;chrome.runtime.onMessage.addListener(((e,t,r)=>{const a=JSON.parse(e);if("filter"===a.key){m(a.data);try{s()}catch(e){console.log(e)}r("")}return!0})),document.addEventListener("scroll",(()=>{if(a){a=!1;try{s()}catch(e){console.log(e)}setTimeout((()=>{a=!0}),1e3)}}));const s=()=>{let a,s=document.getElementById("main-content");if(null===s)s=document.getElementById("siteTable"),a=e;else{const e=s.getElementsByTagName("shreddit-feed");e.length>0?(s=e[0],a=r):(s=s.children[2],a=t)}const l=JSON.parse(window.localStorage.getItem("subredditFilterOptions"))||null;n(s,l)&&i(s,l,a)},n=(e,t)=>null!==t&&null!==e,i=(r,a,s)=>{for(let n of r.children)l(n,s)&&!g(n,s)&&d(n,a,s)?u(n,s):(s===t&&"FACEPLATE-BATCH"===n.tagName||s===e&&"sitetable linklisting"===n.getAttribute("class"))&&i(n,a,s)},l=(a,s)=>{switch(s){case e:return 0!==a.getAttribute("data-subreddit");case t:case r:return"ARTICLE"===a.tagName;default:return!1}},d=(t,r,a)=>{let s,n;a===e?(s=o(t,a),n=parseFloat(c(t,a))):(s=o(t,a),n=c(t,a));const i=r[s];if(void 0===i)return!1;const l=i.filterCategory,d=new Date(i.filterDateTime+"Z"),u=new Date(n);return"before"===l&&u<=d||"after"===l&&u>=d},o=(t,r)=>r===e?t.getAttribute("data-subreddit"):t.getElementsByTagName("shreddit-post")[0].getAttribute("subreddit-prefixed-name").substring(2),c=(t,r)=>r===e?t.getAttribute("data-timestamp"):t.getElementsByTagName("shreddit-post")[0].getAttribute("created-timestamp"),u=(a,s)=>{switch(s){case e:case t:case r:a.style.opacity=0;break;default:return}},g=(a,s)=>{switch(s){case e:case t:case r:return 0===a.style.opacity;default:return!1}},m=e=>{window.localStorage.setItem("subredditFilterOptions",JSON.stringify(e))};try{s()}catch(e){console.log(e)}setInterval((()=>{try{s()}catch(e){console.log(e)}}),1e3)})();